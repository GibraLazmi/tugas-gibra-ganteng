name: PHP CI - Lint & Smoke Tests
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]
jobs:
  php-smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: shivammathur/setup-php@v2
        with:
          php-version: '8.1'
      - run: find . -type f -name "*.php" -print | xargs -I{} php -l {}
      - run: nohup php -S 127.0.0.1:8000 -t login > server.log 2>&1 & sleep 2
      - run: curl -f http://127.0.0.1:8000/signup.php
      - run: curl -f http://127.0.0.1:8000/login.php

      - name: Run smoke tests
        run: bash tests/smoke.sh
